<!DOCTYPE html>
<html>
<head>
  <title>Target Scoring System</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<div class="header">
  <h1>ðŸŽ¯ Electronic Target Scoring</h1>
  <div>
    <button class="btn btn-gold" onclick="toggle()">Start / Stop</button>
    <button class="btn btn-red" onclick="reset()">Reset</button>
	<button class="btn btn-gold" onclick="fetch('/toggle_heatmap')">
  Heatmap
</button>
<a href="/spectator" class="btn">Spectator</a>
<a href="/calibrate" class="btn">Calibrate</a>
  </div>
</div>

<div class="main">

  <!-- CAMERA -->
  <div class="panel">
    <div class="panel-title">Live Target Feed</div>
    <div class="viewport">
      <img src="/video/0">
    </div>
    <div id="status" class="status inactive">Detection stopped</div>
  </div>

  <!-- SCORE -->
  <div class="panel score-box">
    <div class="panel-title">Scoring</div>

    <div id="total" class="score-total">0</div>

    <div id="hits" class="hit-log"></div>
  </div>

</div>

<script>
async function toggle() {
  const r = await fetch("/toggle");
  const j = await r.json();
  const s = document.getElementById("status");
  s.textContent = j.active ? "Detection running" : "Detection stopped";
  s.className = "status " + (j.active ? "active" : "inactive");
}

async function reset() {
  await fetch("/reset");
  document.getElementById("hits").innerHTML = "";
  document.getElementById("total").textContent = "0";
}

async function refreshHits() {
  const r = await fetch("/hits");
  const hits = await r.json();

  const log = document.getElementById("hits");
  log.innerHTML = "";

  let total = 0;
  hits.forEach(h => {
    const s = document.createElement("span");
    s.textContent = h.score;
    log.appendChild(s);
    total += h.score;
  });

  document.getElementById("total").textContent = total;
}

setInterval(refreshHits, 500);
</script>

</body>
</html>